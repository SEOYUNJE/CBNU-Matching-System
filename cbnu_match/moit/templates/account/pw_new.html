{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</title>
    <link rel="stylesheet" href="{% static 'account/css/pw_new.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <header class="header">
    <div class="logo">moit</div>
    <nav class="nav">
      <a href="#">meals</a>
      <a href="#">study</a>
      <a href="#">game</a>
      <a href="#">exercise</a>
    </nav>
    <div class="util">ğŸ” ğŸ‘¤</div>
  </header>

  <main>
    <div class="pw_change-container">
      <h1 class="title">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h1>

      <form action="{%url 'password_reset'%}" method="POST" id="pw_change-form" novalidate>
        {% csrf_token %}
        <input type="hidden" name="username" value="{{ username }}">
        <!-- ë¹„ë°€ë²ˆí˜¸ -->
        <div class="field">
          <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
          <input
            id="password"
            type="password"
            name="new_password"
            oninput="validateForm()"
            placeholder="ì˜ë¬¸,ìˆ«ì 8~25ì ì¡°í•©"
            required />
          <p class="error-message" id="pw-pattern-error" style="display:none;">ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸ìì™€ ìˆ«ìë¥¼ í¬í•¨í•œ 8~25ìì—¬ì•¼ í•©ë‹ˆë‹¤.</p> 
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
        <div class="field">
          <label for="password-confirm">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input
            id="password-confirm"
            type="password"
            name="new_password_check"
            oninput="validateForm()"
            placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"
            required />
          <p class="error-message" id="pw-match-error" style="display:none;">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </div>

        <button type="submit" class="btn-pw" disabled>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°</button>
      </form>
    </div>
  </main>

  <script>
  $(function(){
    const $p1           = $('#password');
    const $p2           = $('#password-confirm');
    const $patternError = $('#pw-pattern-error');
    const $matchError   = $('#pw-match-error');
    const $submit       = $('.btn-pw');  // ì—¬ê¸° ìˆ˜ì •ë¨

    // ì˜ë¬¸+ìˆ«ì ì¡°í•©, 8~25ì
    const reg = /^(?=.*[A-Za-z])(?=.*\d).{8,25}$/;

    function validateForm(){
      const p1 = $p1.val().trim();
      const p2 = $p2.val().trim();
      let valid = true;

      // 1) ë¹„ë°€ë²ˆí˜¸ íŒ¨í„´ ê²€ì‚¬
      if (p1 === '') {
        $patternError.hide();
      } else if (!reg.test(p1)) {
        $patternError.show().text('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸ìì™€ ìˆ«ìë¥¼ í¬í•¨í•œ 8~25ìì—¬ì•¼ í•©ë‹ˆë‹¤.');
        valid = false;
      } else {
        $patternError.hide();
      }

      // 2) ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ê²€ì‚¬
      if (p2 === '') {
        $matchError.hide();
      } else if (p1 !== p2) {
        $matchError.show().text('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        valid = false;
      } else {
        $matchError.hide();
      }

      // 3) ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
      $submit.prop('disabled', !(valid && p1 !== '' && p2 !== ''));
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    $p1.add($p2).on('input', validateForm);

    // ì´ˆê¸° ìƒíƒœ
    validateForm();
  });
  </script>

</body>
</html>
